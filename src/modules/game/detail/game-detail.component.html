<div class="container">
    <div class="left-container">
        <div class="game-bar">
            @if (isLoading) {
                <game-image-skeleton [showDetails]="false"></game-image-skeleton>
            } @else {
                <game-image
                    [game]="game"
                    [showDetails]="false">
                </game-image>
            }

            <div>
                @if (isUserLoggedIn) {
                    <app-button
                        (onClick)="openModal()"
                        [disabled]="!game.name">
                        Edit
                    </app-button>
                }

                <div
                    class="rating-container"
                    [class.mt-0]="!isUserLoggedIn">
                    <star-rating
                        [rating]="game.rating"
                        color="#3f4b64"
                        colorSelected="#ea377a"
                        [size]="48">
                    </star-rating>
                </div>
            </div>
        </div>

        <div class="game-information">
            <app-label
                label="Status"
                [textTemplate]="statusText"
                [isLoading]="isLoading">
            </app-label>

            <ng-template #statusText>
                <div class="d-flex align-center">
                    <status [type]="game.statusDescription"></status>
                    {{ game.statusDescription }}
                </div>
            </ng-template>

            <app-label
                label="Platform"
                [text]="game.platformText"
                [isLoading]="isLoading">
            </app-label>

            <app-label
                label="Released in"
                [text]="game.releaseDate | date: 'dd/MM/yyyy'"
                [isLoading]="isLoading">
            </app-label>

            <app-label
                label="Time played"
                [text]="game.timePlayed.hours ? game.timePlayed.hours + ' hours and ' + game.timePlayed.minutes + ' minutes' : '-'"
                [isLoading]="isLoading">
            </app-label>

            <app-label
                label="Is campaign complete?"
                [text]="game.isCampaignComplete ? 'Yes' : 'No'"
                [isLoading]="isLoading">
            </app-label>

            <app-label
                label="Is platinumed?"
                [text]="game.isPlatinumed ? 'Yes' : 'No'"
                [isLoading]="isLoading">
            </app-label>

            <app-label
                label="Date completed"
                [text]="game.isPlatinumed || game.isCampaignComplete ? (game.lastTimePlayed | date: 'dd/MM/yyyy HH:mm:ss') : '-'"
                [isLoading]="isLoading">
            </app-label>
        </div>
    </div>
    <div class="right-container">
        @if (isLoading) {
            <div class="loading-skeleton title-skeleton"></div>
            <div class="loading-skeleton description-skeleton"></div>
        } @else {
            <div class="game-title">{{ game.name }}</div>

            <div
                class="game-description"
                [class.opened]="readMoreActive"
                #readMoreContainer>
                {{ game.description }}
            </div>

            <div class="d-flex">
                @if (readMoreContainer.offsetHeight < readMoreContainer.scrollHeight && !readMoreActive) {
                    <a
                        class="read-more-buttons"
                        (click)="toggleReadMore()">
                        Read more
                    </a>
                }

                @if (readMoreActive) {
                    <a
                        class="read-more-buttons"
                        (click)="toggleReadMore()">
                        Read less
                    </a>
                }
            </div>
        }

        <row customClass="mt-20i">
            <app-label
                label="Genres"
                [textTemplate]="genreTemplate"
                [inputSize]="6"
                [isLoading]="isLoading">
            </app-label>

            <ng-template #genreTemplate>
                <div class="d-flex flex-wrap">
                    @for (genre of game.genresDescription; track $index; let last = $last) {
                        <a
                            class="link"
                            href="#">
                            <span>{{ genre.name }}</span>
                        </a>

                        @if (!last) {
                            <span>,&nbsp;</span>
                        }
                    }

                    @if (!game.genresDescription.length) {
                        -
                    }
                </div>
            </ng-template>

            <app-label
                label="Themes"
                [textTemplate]="themeTemplate"
                [inputSize]="6"
                [isLoading]="isLoading">
            </app-label>

            <ng-template #themeTemplate>
                <div class="d-flex flex-wrap">
                    @for (theme of game.themesDescription; track $index; let last = $last) {
                        <a
                            class="link"
                            href="#">
                            <span>{{ theme.name }}</span>
                        </a>

                        @if (!last) {
                            <span>,&nbsp;</span>
                        }
                    }

                    @if (!game.themesDescription.length) {
                        -
                    }
                </div>
            </ng-template>
        </row>

        <row customClass="mt-10i">
            <app-label
                label="Published by"
                [text]="game.publisher"
                [inputSize]="6"
                [isLoading]="isLoading">
            </app-label>

            <app-label
                label="Developed by"
                [text]="game.developer"
                [inputSize]="6"
                [isLoading]="isLoading">
            </app-label>
        </row>

        <div class="achievements-title">Achievements</div>

        <row>
            @if (isLoading) {
                @for (_ of [].constructor(30); track $index) {
                    <game-achievement-skeleton></game-achievement-skeleton>
                }
            }

            @for (achievement of game.achievements; track $index) {
                <game-achievement [achievement]="achievement"> </game-achievement>
            }
        </row>

        @if (!game.achievements.length && !isLoading) {
            <div class="no-achievements">This game does not have achievements.</div>
        }
    </div>
</div>
